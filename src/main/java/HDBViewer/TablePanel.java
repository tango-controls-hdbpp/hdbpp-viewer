/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package HDBViewer;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Toolkit;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.StringSelection;
import java.io.IOException;
import javax.swing.BorderFactory;
import javax.swing.ButtonGroup;
import javax.swing.JCheckBox;
import javax.swing.JFileChooser;
import javax.swing.JPanel;
import javax.swing.JRadioButton;
import javax.swing.JScrollPane;

/**
 *
 * @author pons
 */
public class TablePanel extends javax.swing.JPanel {

  MainPanel parent;
  MultiLineTable table;
  JScrollPane tableView;

  ButtonGroup buttonGroup;
  JRadioButton dateButton;
  JRadioButton timeButton;
  JCheckBox showHeaderButton;
  GridBagConstraints gridBagConstraints;
  JPanel aPanel;
  JPanel tPanel;
 
  /**
   * Creates new form TablePanel
   */
  TablePanel(MainPanel parent) {

    this.parent = parent;
    initComponents();
    
    displayErrorCheck.setSelected(true);
    table = new MultiLineTable();
    tableView = new JScrollPane(table);
    tablePanel.add(tableView, BorderLayout.CENTER);
    setPreferredSize(new Dimension(800, 600));
    
    
    // Accessory panel
    buttonGroup = new ButtonGroup();
    aPanel = new JPanel();
    tPanel = new JPanel();
    dateButton = new JRadioButton();
    timeButton = new JRadioButton();

    tPanel.setBorder(BorderFactory.createTitledBorder("Time Format"));
    tPanel.setLayout(new GridBagLayout());

    buttonGroup.add(dateButton);
    dateButton.setSelected(true);
    dateButton.setText("Date/Time");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
    tPanel.add(dateButton, gridBagConstraints);

    buttonGroup.add(timeButton);
    timeButton.setText("Second since EPOCH");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 1;
    gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
    tPanel.add(timeButton, gridBagConstraints);
    
    
    showHeaderButton = new JCheckBox("Write header");
    showHeaderButton.setSelected(true);
    
    aPanel.setLayout(new BorderLayout());
    aPanel.add(showHeaderButton,BorderLayout.NORTH);
    aPanel.add(tPanel,BorderLayout.SOUTH);    
    
  }
  


  /**
   * This method is called from within the constructor to initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is always
   * regenerated by the Form Editor.
   */
  @SuppressWarnings("unchecked")
  // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
  private void initComponents() {

    tablePanel = new javax.swing.JPanel();
    tableBtnPanel = new javax.swing.JPanel();
    doMicroCheck = new javax.swing.JCheckBox();
    displayErrorCheck = new javax.swing.JCheckBox();
    doQualityCheck = new javax.swing.JCheckBox();
    saveButton = new javax.swing.JButton();
    copyButton = new javax.swing.JButton();

    setLayout(new java.awt.BorderLayout());

    tablePanel.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.LOWERED));
    tablePanel.setLayout(new java.awt.BorderLayout());
    add(tablePanel, java.awt.BorderLayout.CENTER);

    tableBtnPanel.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.RIGHT, 5, 1));

    doMicroCheck.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
    doMicroCheck.setText("Display microseconds");
    doMicroCheck.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        doMicroCheckActionPerformed(evt);
      }
    });
    tableBtnPanel.add(doMicroCheck);

    displayErrorCheck.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
    displayErrorCheck.setText("Display errors");
    displayErrorCheck.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        displayErrorCheckActionPerformed(evt);
      }
    });
    tableBtnPanel.add(displayErrorCheck);

    doQualityCheck.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
    doQualityCheck.setText("Display quality");
    doQualityCheck.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        doQualityCheckActionPerformed(evt);
      }
    });
    tableBtnPanel.add(doQualityCheck);

    saveButton.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
    saveButton.setText("Save file");
    saveButton.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        saveButtonActionPerformed(evt);
      }
    });
    tableBtnPanel.add(saveButton);

    copyButton.setFont(new java.awt.Font("Dialog", 0, 12)); // NOI18N
    copyButton.setText("Copy Selection");
    copyButton.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        copyButtonActionPerformed(evt);
      }
    });
    tableBtnPanel.add(copyButton);

    add(tableBtnPanel, java.awt.BorderLayout.SOUTH);
  }// </editor-fold>//GEN-END:initComponents

  private void doMicroCheckActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_doMicroCheckActionPerformed

    table.doMicroSec(doMicroCheck.isSelected());

  }//GEN-LAST:event_doMicroCheckActionPerformed

  private void saveButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveButtonActionPerformed

    JFileChooser chooser = new JFileChooser(".");    
    chooser.setAccessory(aPanel);
    
    if (chooser.showSaveDialog(null) == JFileChooser.APPROVE_OPTION) {
      try {
        int timeFormat = dateButton.isSelected()?MultiLineTableModel.DATE_TIME_FORMAT:MultiLineTableModel.EPOCH_FORMAT;
        table.saveFile(chooser.getSelectedFile().getAbsolutePath(),timeFormat,showHeaderButton.isSelected());
      } catch(IOException e) {
        Utils.showError(e.getMessage());
      }
    }
    
  }//GEN-LAST:event_saveButtonActionPerformed

  private void copyButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_copyButtonActionPerformed

    StringSelection stringSelection = new StringSelection( table.getSelectionAsString() );
    Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
    clipboard.setContents( stringSelection, null );
    
  }//GEN-LAST:event_copyButtonActionPerformed

  private void displayErrorCheckActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_displayErrorCheckActionPerformed
   
    table.showError(displayErrorCheck.isSelected());
   
  }//GEN-LAST:event_displayErrorCheckActionPerformed

  private void doQualityCheckActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_doQualityCheckActionPerformed

     table.showQuality(doQualityCheck.isSelected());
     
  }//GEN-LAST:event_doQualityCheckActionPerformed


  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JButton copyButton;
  private javax.swing.JCheckBox displayErrorCheck;
  private javax.swing.JCheckBox doMicroCheck;
  private javax.swing.JCheckBox doQualityCheck;
  private javax.swing.JButton saveButton;
  private javax.swing.JPanel tableBtnPanel;
  private javax.swing.JPanel tablePanel;
  // End of variables declaration//GEN-END:variables
}
